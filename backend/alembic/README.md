# Database Migrations

This directory contains Alembic database migrations for the Ascend AI backend.

## Quick Reference

```bash
# Create a new migration (autogenerate from models)
cd backend
alembic revision --autogenerate -m "description of changes"

# Apply all pending migrations
alembic upgrade head

# Rollback one migration
alembic downgrade -1

# View migration history
alembic history

# View current revision
alembic current
```

## Initial Setup

The initial migration creates the following tables:
- `users` - OAuth authenticated users
- `resumes` - Uploaded resume files and parsed text
- `interview_sessions` - Mock interview sessions with generated questions

## Migration Workflow

1. **Make changes to models** in `app/db/models/`
2. **Generate migration**: `alembic revision --autogenerate -m "add new field"`
3. **Review the generated migration** in `alembic/versions/`
4. **Apply migration**: `alembic upgrade head`
5. **Commit both the model changes and migration file**

## Important Notes

- Always review autogenerated migrations before applying
- Test migrations on a development database first
- Never edit applied migrations - create a new one instead
- Keep migrations small and focused on one change
- Write descriptive migration messages

## Troubleshooting

### "Target database is not up to date"
```bash
alembic upgrade head
```

### "Can't locate revision identified by 'xyz'"
```bash
alembic history
alembic stamp head  # Only if you're sure the database is current
```

### Reset database (DEVELOPMENT ONLY)
```bash
# Drop all tables
docker-compose down -v
docker-compose up -d postgres

# Reapply all migrations
alembic upgrade head
```
